# Рекомендации по структуре файлового хранилища

## Текущая структура (на основе даты)
```
storage/<год>/<месяц>/<id>.rep.gz
```

### Плюсы:
- ✅ Простая организация
- ✅ Легко найти реплеи по времени загрузки
- ✅ Автоматическое распределение по папкам предотвращает переполнение одной директории

### Минусы:
- ❌ Не связана с играми - реплеи разных игр смешаны
- ❌ Сложно найти все реплеи одной игры в файловой системе
- ❌ При удалении всех реплеев игры остаются пустые папки

## Альтернативные варианты

### Вариант 1: По играм (рекомендуется для вашего случая)
```
storage/<game_name>/<id>.rep.gz
```

**Плюсы:**
- ✅ Логическая группировка по играм
- ✅ Легко найти все реплеи игры
- ✅ Легко удалить все реплеи игры
- ✅ Простая структура

**Минусы:**
- ⚠️ Если у игры тысячи реплеев, одна папка может быть переполнена
- ⚠️ Нужна валидация/нормализация названий игр (пробелы, спецсимволы)

**Решение проблем:**
- Нормализовать название игры для пути: `game-name` вместо `Game Name!`
- При большом количестве реплеев можно добавить подпапки по первым символам ID

### Вариант 2: Гибридный (игра + дата)
```
storage/<game_name>/<год>/<месяц>/<id>.rep.gz
```

**Плюсы:**
- ✅ Группировка по играм
- ✅ Дополнительная организация по времени
- ✅ Защита от переполнения папок

**Минусы:**
- ⚠️ Более сложная структура
- ⚠️ Больше вложенности

### Вариант 3: Плоская структура с хешированием
```
storage/<первые_2_символа_id>/<id>.rep.gz
```

**Плюсы:**
- ✅ Равномерное распределение
- ✅ Не зависит от метаданных
- ✅ Масштабируемость

**Минусы:**
- ❌ Нет логической группировки
- ❌ Невозможно найти реплеи игры без БД

## Рекомендация

Для вашего случая (личное использование, простой проект) рекомендую **Вариант 1**:

```
storage/<game_name>/<id>.rep.gz
```

### Почему:
1. Вы хотите группировать реплеи по играм - это прямо отвечает требованию
2. Для личного использования количество реплеев вряд ли будет огромным
3. Простота важнее масштабируемости в вашем случае
4. Легко найти и управлять реплеями конкретной игры

### Реализация:

```go
// Нормализация названия игры для использования в пути
func normalizeGameName(gameName string) string {
    // Заменяем пробелы и спецсимволы на дефисы
    normalized := strings.ToLower(gameName)
    normalized = regexp.MustCompile(`[^a-z0-9]+`).ReplaceAllString(normalized, "-")
    normalized = strings.Trim(normalized, "-")
    
    // Если название пустое после нормализации, используем "unknown"
    if normalized == "" {
        return "unknown"
    }
    
    return normalized
}

// Генерация пути для реплея
func generateReplayPath(storageDir string, gameName string, replayID uuid.UUID) string {
    normalizedGame := normalizeGameName(gameName)
    return filepath.Join(storageDir, normalizedGame, fmt.Sprintf("%s.rep.gz", replayID))
}
```

### Миграция существующих файлов:

Если у вас уже есть реплеи в старой структуре, можно написать скрипт миграции:

```go
// Переместить файлы из storage/<год>/<месяц>/<id>.rep.gz
// в storage/<game_name>/<id>.rep.gz
```

### Если игра не указана:

Для реплеев без указанной игры можно использовать папку `unknown`:
```
storage/unknown/<id>.rep.gz
```
